#Name: CVE-2020-1350 - SigRed - DNS RCE
#Affects: All Windows based DNS servers

#Description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process
# - https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/
# - https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html

# - CyberGuard 2020

#EventLog Required: Sysmon

Query:
Sysmon
| where EventID == 1
| where ParentCommandLine contains "\\System32\\dns.exe"
| where CommandLine !contains "\\System32\\werfault.exe" or CommandLine !contains "\\System32\\conhost.exe" or CommandLine !contains "\\System32\\dnscmd.exe"
| extend HostCustomEntity = Computer
| extend AccountCustomEntity = UserName
